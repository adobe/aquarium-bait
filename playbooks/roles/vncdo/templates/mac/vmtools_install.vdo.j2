# Script to install the mounted vmtools iso
# Right now it serving 3 ways of installing:
#  MacOS 1015 - right after the OS install
#  MacOS 1106:
#   - right after the OS install
#   - install as a part of the separated image (with details button of multiple installed kexts)
#  TODO: Split the templates for each particular purpose to simplify the action list supportability

# Wait for window with iso opens, selecting the first "Install VMware Tools" item and open it
pause 20 key tab key super-down pause 10

# Enter voiceover
key super-f5 pause 5 key right pause 2 key right pause 2 key esc

# On welcome screen switch to and press Continue button
pause 10 key tab key space

# On install location switch to and press Install button
pause 10 key shift-tab key space

# On MacOS 10.15 it's generating additional request about installation finishing reboot
# Press Continue installation button by enter
pause 1 key enter

# In password request window enter password and press Install Software button
pause 20 type "{{ ansible_sudo_pass }}" pause 1 key enter

# Wait for installation and enter the security preferences
pause 20 key space

# Click on unlocking the admin changes
pause 10 key shift-tab pause 1 key shift-tab pause 1 key shift-tab pause 1 key shift-tab pause 1 key space

# Enter password to unlock admin changes
pause 5 type "{{ ansible_sudo_pass }}" pause 1 key enter

# Go to Allow button (or details button) and click it
pause 5 key shift-tab pause 1 key alt-ctrl-up pause 1 key space

# From here the process is split in 2 options - with Allow button and with Details one
# On MacOS 10.15 it will not ask for reboot, but the next steps will be harmless

# Allow button: Selecting and pressing Not Now in reboot request popup
# Details button: Select Ok in details window and press it
pause 5 key shift-tab pause 1 key space

# Allow button: (not necessary) In preferences window will switch to back button and press it
# Details button: Selecting and pressing Not Now in reboot request popup
pause 5 key tab key tab key tab pause 1 key space

# Allow button: (not necessary) In preferences window will press the grayed-out back button again
# Details button: Press Allow button again
pause 5 key space

# Allow button: (not necessary) In preferences window will switch to button Next and press it
# Selecting and pressing Not Now in reboot request popup
pause 5 key tab pause 1 key space

# Disable voiceover
pause 1 key super-f5

# Switch back to installer window
pause 5 key super-tab

# Wait 2m for the installation (needed for MacOS 1015) and press Restart button to trigger reboot
pause 120 key enter

# Wait for reboot
pause 120
