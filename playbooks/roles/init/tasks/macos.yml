---
- name: Set GMT timezone
  include_tasks: macos_systemsetup.yml
  vars:
    key: timezone
    value: GMT

- name: Disable sleep
  include_tasks: macos_systemsetup.yml
  vars:
    key: "{{ item }}"
    value: Never
  with_items:
    - computersleep
    - displaysleep
    - harddisksleep

- name: Disable hibernate
  block:
    - name: Check hibernate status
      shell: "pmset -g | grep 'hibernatemode'"
      become: true
      changed_when: false
      register: reg_hibernate

    - name: Disable hibernate
      when: not reg_hibernate.stdout.endswith('0')
      command: pmset hibernatemode 0
      become: true

- name: Disable App Sleep
  osx_defaults:
    key: NSAppSleepDisabled
    type: bool
    value: true

- name: Disable screensaver password
  osx_defaults:
    host: currentHost
    domain: com.apple.screensaver
    key: askForPassword
    type: bool
    value: false

- name: Disable automatic update check
  osx_defaults:
    domain: /Library/Preferences/com.apple.SoftwareUpdate
    key: AutomaticCheckEnabled
    type: int
    value: 0
  become: true

- name: Disable Spotlight indexing
  block:
    - name: Check indexing status
      command: mdutil -s /
      become: true
      changed_when: false
      register: reg_indexing

    - name: Disable Spotlight indexing
      when: not reg_indexing.stdout.endswith('Indexing disabled.')
      command: mdutil -i off /
      become: true
